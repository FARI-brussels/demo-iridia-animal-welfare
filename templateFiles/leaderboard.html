<!DOCTYPE html>

<title>FARI - Animal welfare</title>
<link rel = "icon" href ="staticFiles/img/marker.png" type = "image/x-icon">
<html lang="en">

<head>
    <link rel="stylesheet" href="staticFiles/style/style.css">
</head>

<body>

    <div class="topbar" href="home">
        <img class="logo" src="staticFiles/img/logo.png" alt="FARI Institute">
        <ul>
            <li><a href="{{url_for('play')}}">Play</a></li>
            <li class="current"><a href="{{url_for('leaderboard')}}">Leaderboard</a></li>
            <li><a id="home" href="{{url_for('home')}}">Rules</a></li>
        </ul>
    </div>
    

    <div class="score">
        <br>
        <h3 class="titlescore">Name | Score</h3>
        <ul id="leaderboard">
        </ul>
        <div class="center">
            <a id="button" class="but_play" href="{{url_for('play')}}">Play again</a>
        </div>
    </div>
    

</body>
</html>

<script>
    var play = {{players | tojson}}; //Move the Python dict into JS object

    // Put the new names and score in the leaderboard
    function updateLeaderboard(){
        var text = document.getElementById("leaderboard");
        for (const [key, value] of Object.entries(play)) {
            text.innerHTML += "<li><b class='textscore2'>" + key + "</b><p class='textscore'>" + value + "</p></li>";
        }
    }

    // Sort the dictionnary of username:score by decreasing score
    function sortDict(dict) {
        const sortable = Object.fromEntries(
            Object.entries(dict).sort(([,a],[,b]) => b-a)
        );
        return sortable;
    }

    // Convert a Python dict into a JavaScript dict strucutre
    function convertPyDictInJSDict(pydict){
        var dict = {}
        for (let i = 0; i < pydict.length; i++) {
            dict[pydict[i]["pseudo"]] = play[i]["score"];       
        }
        return dict;
    }

    function resetDataServer(){
        var value = 0
        var xmlHttp = new XMLHttpRequest();
        var url = "/getreset/" + String(value);
        xmlHttp.open( "GET", url, false ); // false for synchronous request
        xmlHttp.send(null);
    }

    play = convertPyDictInJSDict(play);
    play = sortDict(play);    
    updateLeaderboard();

    var btn = document.getElementById("button");
	btn.addEventListener("click", resetDataServer);

</script>