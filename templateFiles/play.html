<!DOCTYPE html>

<title>FARI - DEMO</title>
<link rel = "icon" href ="staticFiles/img/marker.png" type = "image/x-icon">
<html lang="en">

<head>
    <link rel="stylesheet" href="staticFiles/style/style.css">
</head>

<body>
    <div>
        <h1 id="wintxt" class="wintext">+100</h1>
        <h1 id="scoretxt" class="scoretext">Score : 0</h1>
        <h1 id="timer" class="timetext">Time : 0</h1>
    </div>
    
    <img class="logo" src="staticFiles/img/logo.png" alt="FARI Institute">

    <div class="topbar" href="home">
        <ul>
            <li class="current"><a href="{{url_for('play')}}">Restart</a></li>
            <li><a href="{{url_for('leaderboard')}}">Leaderboard</a></li>
            <li><a href="{{url_for('home')}}">Rules</a></li>
        </ul>
    </div>

    <div id="slider" class="slide">
        <p>Test</p>
    </div>


    <div id="m" class="map"></div>
    <div id="marker" title="Marker"></div>
    <div id="popup"></div>

    <audio id="audio_win" src="staticFiles/audio/win.mp3"></audio>
    <audio id="audio_lose" src="staticFiles/audio/lose.mp3"></audio>
</body>
</html>

<script src="staticFiles/js/OpenLayers.js"></script>
<script>
    var currentscore = 0;
    var timer = 0;
    var ads = {{ads | tojson}};

    map = new OpenLayers.Map("m");
    map.addLayer(new OpenLayers.Layer.OSM());
    epsg4326 =  new OpenLayers.Projection("EPSG:4326"); //WGS 1984 projection
    projectTo = map.getProjectionObject(); //The map projection (Spherical Mercator)
    var lonLat = new OpenLayers.LonLat(4.350665, 50.848638).transform(epsg4326, projectTo);
    var zoom=11;
    map.setCenter(lonLat, zoom);
    var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
    
    // Ads the different ads to the map
    for (let i = 0; i < ads.length; i++) {
        var feature = new OpenLayers.Feature.Vector(
        new OpenLayers.Geometry.Point( ads[i]['lat'], ads[i]['long'] ).transform(epsg4326, projectTo),
            {description: ads[i]['description']},
            {externalGraphic: 'staticFiles/img/marker.png', graphicHeight: 40, graphicWidth: 40, graphicXOffset:-25, graphicYOffset:-25}
        );    
        vectorLayer.addFeatures(feature);       
    }

    map.addLayer(vectorLayer);
     
    var controls = {
      selector: new OpenLayers.Control.SelectFeature(vectorLayer, { onSelect: createPopup, onUnselect: destroyPopup })
    };

    function createPopup(feature) {
        var text = document.getElementById("slider");
        text.innerHTML = feature.attributes.description;// Put Value
        text.style.opacity = '1';
        text.style.marginLeft = 'calc(100% - 385px)';
    }

    function destroyPopup(feature) {
        var text = document.getElementById("slider");
        text.innerHTML = feature.attributes.description;// Put Value
        text.style.opacity = '0';
    }
    
    map.addControl(controls['selector']);
    controls['selector'].activate();
    
    // Action done when the user choose "Legal" or "Illegal" in an ads
    function doAction(value){
        if(value==0){
            var audio = document.getElementById("audio_lose");
            audio.play()
        }
        else{
            var audio = document.getElementById("audio_win");
            audio.play()
        }
        var text = document.getElementById("wintxt");
        text.innerHTML = "+" + String(value);// Put Value
        text.style.display = "block";
        text.style.opacity = '1';
        setTimeout(hideElement, 2000) //milliseconds until timeout//
        
        function hideElement() {
            text.style.opacity = '0';
        }
        currentscore += value;
        var score = document.getElementById("scoretxt");
        score.innerHTML = "Score : " + String(currentscore);// Put Value
    }

    // Function for the timer
    var timerId= setInterval(()=>{getTime()},1000);
    function getTime(){
        timer += 1
        document.getElementById("timer").innerHTML = "Time : " + String(timer);
    }
    

</script>
